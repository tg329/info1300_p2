<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <style>
        .tooltip {
            pointer-events: none;
        }

        .state {
            fill: none;
        }

        .outline {
            fill: none;
            stroke: black;
            stroke-width: 0.5px;
        }
    </style>
</head>

<body>
    <div id="tooltip" class="tooltip"></div>

    <!-- Choropleth Map -->
    <svg id="choropleth" height="1000" width="1000"></svg>
    <script>
        const svg = d3.select("#choropleth");
        const width = svg.attr("width");
        const height = svg.attr("height");
        const margin = { top: 20, right: 100, bottom: 20, left: 100 };
        const mapWidth = width - margin.left - margin.right;
        const mapHeight = height - margin.top - margin.bottom;
        const map = svg
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")")

        const requestData = async function () {
            const us = await d3.json("us-smaller.json");

            var states = topojson.feature(us, us.objects.states);
            var statesMesh = topojson.mesh(us, us.objects.states);
            var projection = d3
                .geoAlbersUsa()
                .fitSize([mapWidth, mapHeight], states);
            var path = d3.geoPath().projection(projection);

            let statePaths = map
                .selectAll("path.state")
                .data(states.features)
                .join("path")
                .attr("class", "state")
                .attr("d", path);
            map
                .append("path")
                .datum(statesMesh)
                .attr("class", "outline")
                .attr("d", path);

            const pop = await d3.csv("pop_all_years", d3.autoType);
            const prod = await d3.csv("producer_years.csv", d3.autoType);

            const populationByStateYear = {};
            pop.forEach(row => {
                const state = row.States;
                Object.keys(row).forEach(year => {
                    if (year !== "States") {
                        populationByStateYear[`${state}-${year}`] = +row[year];
                    }
                });
            });
            
            console.log(populationByStateYear);



        };
        requestData();
    </script>
</body>

</html>